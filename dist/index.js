(()=>{var l="http://www.w3.org/2000/svg",m=(u,t,e,i)=>{let r=(i-90)*Math.PI/180,n=u+e*Math.cos(r),a=t+e*Math.sin(r);return{x:n,y:a}},p=(u,t,e,i,r)=>{let n=m(u,t,e,r),a=m(u,t,e,i),s=r-i<=180?"0":"1",c=`M ${n.x} ${n.y}`,o=`A ${e} ${e} 0 ${s} 0 ${a.x} ${a.y}`;return`${c} ${o}`},A=()=>"ontouchstart"in window||navigator.maxTouchPoints,S=class{constructor(t){this.dragging=null;this.element=document.createElementNS(l,"svg"),this.arcGroup=document.createElementNS(l,"g"),this.lineGroup=document.createElementNS(l,"g"),this.element.append(this.arcGroup,this.lineGroup),this.updateDraggablePieOptions(t)}async updateDraggablePieOptions(t){if(t.id&&(this.element.id=t.id),t.class&&this.element.classList.add(t.class),t.datasets){await new Promise(requestAnimationFrame),this.arcGroup.innerHTML="",this.lineGroup.innerHTML="";let e=this.element.getBoundingClientRect(),i=t.datasets?.reduce((r,n)=>r+n.value,0)||0;t.datasets.forEach((r,n)=>{let a=document.createElementNS(l,"path"),s=document.createElementNS(l,"line"),c=Number(this.arcGroup.children[n-1]?.dataset.endAngle||0),o=c+r.value/i*360;a.dataset.index=s.dataset.index=String(n),a.dataset.startAngle=String(c),a.setAttribute("fill","none"),this.updateArc({arc:a,line:s,boundingClientRect:e,startAngle:c,endAngle:o,dataset:r}),this.arcGroup.appendChild(a),this.lineGroup.appendChild(s),A()?(s.addEventListener("touchstart",d=>this.dragStart(d)),document.addEventListener("touchmove",d=>this.dragMove(d)),document.addEventListener("touchend",()=>this.dragEnd())):(s.addEventListener("mousedown",d=>this.dragStart(d)),document.addEventListener("mousemove",d=>this.dragMove(d)),document.addEventListener("mouseup",()=>this.dragEnd()))})}}dragStart(t){let e=t.target,i=this.arcGroup.children[Number(e.dataset.index)];this.dragging={arc:i,line:e}}dragMove(t){if(!this.dragging)return;let e=this.element.getBoundingClientRect(),{x:i,y:r}=(()=>{let{clientX:b,clientY:E}=t instanceof MouseEvent?t:t.targetTouches[0];return{x:b-e.left-e.width/2,y:E-e.y-e.height/2}})(),n=Math.atan2(r-0,i-0),a=Number(this.dragging.arc.dataset.startAngle||0),s=n*180/Math.PI+90,c=a,o=this.arcGroup.children[Number(this.dragging.arc.dataset?.index)+1]||this.arcGroup.children[0],d=this.lineGroup.children[Number(this.dragging.line.dataset?.index)+1]||this.lineGroup.children[0],g=Number(o.dataset?.endAngle||0),h=s%360;c>s||h>g||(this.updateArc({arc:this.dragging.arc,line:this.dragging.line,boundingClientRect:e,startAngle:c,endAngle:s}),this.updateArc({arc:o,line:d,boundingClientRect:e,startAngle:h,endAngle:g}))}dragEnd(){this.dragging=null}updateArc({arc:t,line:e,boundingClientRect:i,startAngle:r,endAngle:n,dataset:a}){let s=i.width/2,c=i.height/2,o=Math.min(s,c),d=o/2;t.dataset.startAngle=String(r),t.dataset.endAngle=String(n),a?.color&&t.setAttribute("stroke",a.color),t.setAttribute("stroke-width",String(o)),t.setAttribute("d",p(s,c,d,r,n)),this.updateLine({line:e,origin:{x:s,y:c},distance:o,angle:n})}updateLine({line:t,origin:e,distance:i,angle:r}){let n=(r-90)*Math.PI/180,a=e.x+i*Math.cos(n),s=e.y+i*Math.sin(n);t.setAttribute("stroke","#333333"),t.setAttribute("stroke-width","5"),t.setAttribute("x1",String(e.x)),t.setAttribute("y1",String(e.y)),t.setAttribute("x2",String(a)),t.setAttribute("y2",String(s))}};})();
